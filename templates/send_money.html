{% extends "base.html" %}
{% block title %}Send Money{% endblock %}
{% block content %}

<h2>Send Money</h2>

<form method="post" action="{{ url_for('send_money') }}">
    {{ form.hidden_tag() }}

    <div class="form-group">
        <label>Amount in ZAR</label>
        <input type="number" name="amount" id="amount" class="form-control" required>
    </div>

    <div class="form-group">
        <label>Choose Currency</label>
        <select name="currency" id="currency" class="form-control">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
            <option value="CNY">CNY</option>
            <option value="BWP">BWP</option>
        </select>
    </div>

    <div class="form-group">
        <label>Beneficiary Bank Account</label>
        <input type="text" name="bank_account" class="form-control" required>
    </div>

    <p><strong>Estimated Payout:</strong> <span id="convertedAmount">0.00</span> <span id="currency_label"></span></p>

    <button type="submit" class="btn btn-primary">Send Money</button>
</form>

<script>
    document.getElementById("amount").addEventListener("input", updateConversion);
    document.getElementById("currency").addEventListener("change", updateConversion);

    function updateConversion() {
        let amountZAR = parseFloat(document.getElementById("amount").value) || 0;
        let selectedCurrency = document.getElementById("currency").value;

        if (amountZAR > 0) {
            fetch(`/get_exchange_rate?amount=${amountZAR}&currency=${selectedCurrency}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("convertedAmount").textContent = data.converted_amount;
                    document.getElementById("currency_label").textContent = selectedCurrency;
                })
                .catch(error => console.error("Error fetching exchange rate:", error));
        }
    }
</script>

{% endblock %}
